# æ•°æ®åº“ç®¡ç†è„šæœ¬

è¿™ä¸ªç›®å½•åŒ…å«äº†ç”¨äºç®¡ç†æ•°æ®åº“çš„å®ç”¨è„šæœ¬ã€‚

## å¯ç”¨è„šæœ¬

### 1. åˆå§‹åŒ–æ•°æ®åº“ (`init-database.js`)

**ç”¨é€”**: åˆ›å»ºæ•°æ®åº“å’Œæ‰€æœ‰å¿…éœ€çš„è¡¨

**ä½¿ç”¨æ–¹æ³•**:
```bash
npm run init-db
```

**åŠŸèƒ½**:
- âœ… æµ‹è¯• MySQL è¿æ¥
- âœ… åˆ›å»ºæ•°æ®åº“ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
- âœ… åˆ›å»ºæ‰€æœ‰æ•°æ®è¡¨ï¼ˆusers, processing_jobs, refresh_tokensï¼‰
- âœ… éªŒè¯è¡¨ç»“æ„

**é€‚ç”¨åœºæ™¯**:
- é¦–æ¬¡éƒ¨ç½²é¡¹ç›®
- æ•°æ®åº“ä¸å­˜åœ¨æ—¶
- éœ€è¦åˆ›å»ºè¡¨ç»“æ„æ—¶

---

### 2. æ£€æŸ¥æ•°æ®åº“ (`check-database.js`)

**ç”¨é€”**: æ£€æŸ¥æ•°æ®åº“è¿æ¥å’ŒçŠ¶æ€

**ä½¿ç”¨æ–¹æ³•**:
```bash
npm run check-db
```

**åŠŸèƒ½**:
- âœ… æµ‹è¯•æ•°æ®åº“è¿æ¥
- âœ… åˆ—å‡ºæ‰€æœ‰æ•°æ®è¡¨
- âœ… æ˜¾ç¤ºæ¯ä¸ªè¡¨çš„è®°å½•æ•°å’Œå­—æ®µ
- âœ… ç»Ÿè®¡ç”¨æˆ·æ•°å’Œä»»åŠ¡æ•°
- âœ… æ˜¾ç¤ºä»»åŠ¡çŠ¶æ€åˆ†å¸ƒ

**é€‚ç”¨åœºæ™¯**:
- æ£€æŸ¥æ•°æ®åº“æ˜¯å¦æ­£å¸¸
- æŸ¥çœ‹æ•°æ®ç»Ÿè®¡
- è°ƒè¯•æ•°æ®åº“é—®é¢˜

---

### 3. é‡ç½®æ•°æ®åº“ (`reset-database.js`)

**ç”¨é€”**: åˆ é™¤æ‰€æœ‰è¡¨å’Œæ•°æ®ï¼Œé‡æ–°åˆ›å»ºè¡¨ç»“æ„

**ä½¿ç”¨æ–¹æ³•**:
```bash
npm run reset-db
```

**åŠŸèƒ½**:
- âš ï¸ åˆ é™¤æ‰€æœ‰æ•°æ®è¡¨
- âš ï¸ åˆ é™¤æ‰€æœ‰æ•°æ®
- âœ… é‡æ–°åˆ›å»ºè¡¨ç»“æ„

**è­¦å‘Š**: 
- æ­¤æ“ä½œä¸å¯é€†ï¼
- ä¼šåˆ é™¤æ‰€æœ‰ç”¨æˆ·å’Œå¤„ç†å†å²
- éœ€è¦è¾“å…¥ `YES` ç¡®è®¤

**é€‚ç”¨åœºæ™¯**:
- å¼€å‘ç¯å¢ƒæ¸…ç†æ•°æ®
- æµ‹è¯•è¡¨ç»“æ„å˜æ›´
- å®Œå…¨é‡ç½®æ•°æ®åº“

---

## ä½¿ç”¨æµç¨‹

### é¦–æ¬¡å®‰è£…

1. é…ç½® `.env` æ–‡ä»¶
   ```env
   DB_HOST=localhost
   DB_PORT=3309
   DB_USER=root
   DB_PASSWORD=root
   DB_NAME=video_process_db
   ```

2. åˆå§‹åŒ–æ•°æ®åº“
   ```bash
   npm run init-db
   ```

3. æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
   ```bash
   npm run check-db
   ```

4. å¯åŠ¨åç«¯æœåŠ¡
   ```bash
   npm run dev
   ```

### æ—¥å¸¸ä½¿ç”¨

- **æ£€æŸ¥æ•°æ®åº“**: `npm run check-db`
- **æŸ¥çœ‹æ•°æ®ç»Ÿè®¡**: `npm run check-db`
- **å¼€å‘æ—¶é‡ç½®**: `npm run reset-db`ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

## å¸¸è§é—®é¢˜

### Q: è¿è¡Œè„šæœ¬æ—¶æç¤º "ECONNREFUSED"

**A**: MySQL æœåŠ¡æœªå¯åŠ¨

**è§£å†³æ–¹æ¡ˆ**:
```bash
# Windows
net start MySQL

# æˆ–åœ¨æœåŠ¡ç®¡ç†å™¨ä¸­å¯åŠ¨ MySQL æœåŠ¡
```

### Q: æç¤º "ER_ACCESS_DENIED_ERROR"

**A**: æ•°æ®åº“ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ DB_USER å’Œ DB_PASSWORD
2. ç¡®è®¤ MySQL ç”¨æˆ·æƒé™

### Q: æç¤º "ER_BAD_DB_ERROR"

**A**: æ•°æ®åº“ä¸å­˜åœ¨

**è§£å†³æ–¹æ¡ˆ**:
```bash
npm run init-db
```

### Q: è¡¨ç»“æ„å·²å˜æ›´ï¼Œå¦‚ä½•æ›´æ–°ï¼Ÿ

**A**: ä¸¤ç§æ–¹å¼

**æ–¹å¼ 1**: ä¿ç•™æ•°æ®ï¼ˆæ¨èï¼‰
```bash
npm run migrate
```

**æ–¹å¼ 2**: åˆ é™¤æ‰€æœ‰æ•°æ®
```bash
npm run reset-db
```

## è„šæœ¬è¾“å‡ºç¤ºä¾‹

### init-db è¾“å‡º

```
====================================
  æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
====================================

æ•°æ®åº“é…ç½®:
- ä¸»æœº: localhost
- ç«¯å£: 3309
- ç”¨æˆ·: root
- æ•°æ®åº“: video_process_db

[1/4] æµ‹è¯• MySQL è¿æ¥...
âœ… MySQL è¿æ¥æˆåŠŸ

[2/4] åˆ›å»ºæ•°æ®åº“...
âœ… æ•°æ®åº“ 'video_process_db' å·²å°±ç»ª

[3/4] è¿æ¥æ•°æ®åº“å¹¶åˆ›å»ºè¡¨ç»“æ„...
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ

åˆ›å»ºæ•°æ®è¡¨:
  âœ… users (ç”¨æˆ·è¡¨)
  âœ… processing_jobs (å¤„ç†ä»»åŠ¡è¡¨)
  âœ… refresh_tokens (åˆ·æ–°ä»¤ç‰Œè¡¨)

âœ… è¡¨ç»“æ„åˆ›å»ºæˆåŠŸ

[4/4] éªŒè¯è¡¨ç»“æ„...

æ•°æ®åº“ä¸­çš„è¡¨ (å…± 3 ä¸ª):
  1. processing_jobs
  2. refresh_tokens
  3. users

====================================
  âœ… æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼
====================================
```

### check-db è¾“å‡º

```
====================================
  æ•°æ®åº“çŠ¶æ€æ£€æŸ¥
====================================

[1/3] æµ‹è¯•æ•°æ®åº“è¿æ¥...
âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸

[2/3] æ£€æŸ¥æ•°æ®è¡¨...
âœ… æ‰¾åˆ° 3 ä¸ªè¡¨:

ğŸ“Š users
   è®°å½•æ•°: 5
   å­—æ®µæ•°: 8
   å­—æ®µ: id, email, password_hash, google_id, name...

ğŸ“Š processing_jobs
   è®°å½•æ•°: 12
   å­—æ®µæ•°: 10
   å­—æ®µ: id, user_id, original_file, output_file, job_type...

ğŸ“Š refresh_tokens
   è®°å½•æ•°: 3
   å­—æ®µæ•°: 5
   å­—æ®µ: id, user_id, token, expires_at, created_at...

[3/3] æ•°æ®ç»Ÿè®¡...
âœ… æ•°æ®ç»Ÿè®¡:
   ç”¨æˆ·æ•°: 5
   å¤„ç†ä»»åŠ¡æ•°: 12

   ä»»åŠ¡çŠ¶æ€åˆ†å¸ƒ:
     completed: 10
     processing: 1
     failed: 1

====================================
  âœ… æ£€æŸ¥å®Œæˆ
====================================
```

## æŠ€æœ¯è¯´æ˜

- **æ•°æ®åº“**: MySQL 5.7+
- **ORM**: Sequelize
- **Node.js**: 14.x+
- **ç¼–ç **: UTF-8MB4

## å®‰å…¨æç¤º

âš ï¸ **ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹**:

1. **ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒè¿è¡Œ reset-db**
2. å®šæœŸå¤‡ä»½æ•°æ®åº“
3. ä½¿ç”¨å¼ºå¯†ç 
4. é™åˆ¶æ•°æ®åº“è®¿é—®æƒé™
5. å¯ç”¨ SSL è¿æ¥

## å¤‡ä»½å»ºè®®

ç”Ÿäº§ç¯å¢ƒå»ºè®®å®šæœŸå¤‡ä»½ï¼š

```bash
# å¯¼å‡ºæ•°æ®åº“
mysqldump -u root -p video_process_db > backup.sql

# å¯¼å…¥æ•°æ®åº“
mysql -u root -p video_process_db < backup.sql
```

